<!DOCTYPE html>
<html>
<head>
    <title>File Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body { font-family: Arial; }
        .folder { cursor: pointer; font-weight: bold; font-size: 20px; margin: 20px;}
        .children { margin-left: 20px; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>

<h2 style="font-weight: 800; font-size: 30px;">My File Explorer</h2>
<div id="explorer" style="margin-left: 100px;">Loading Files Please Wait...</div>

<script>
    function loadFolder(path, container) {
        history.replaceState(null, "", "/home?path=" + decodeURIComponent(path));
        fetch(`/files?path=${encodeURIComponent(path)}`)
            .then(res => res.json())
            .then(items => {

                container.innerHTML = ""; // clear

                items.forEach(item => {
                    const div = document.createElement("div");

                    if (item.isFolder) {
                        div.innerHTML = `<i class="fa-regular fa-folder" style="font-size:25px; color: #FFD43B;"></i> <span class="folder">${item.name}</span>`;

                        const childrenContainer = document.createElement("div");
                        childrenContainer.classList.add("children");

                        div.querySelector(".folder").onclick = () => {
                            if (childrenContainer.innerHTML.trim() === "") {
                                loadFolder(item.fullPath, childrenContainer);
                            } else {
                                childrenContainer.innerHTML = "";
                            }
                        };

                        div.appendChild(childrenContainer);
                        

                    } else {
                        div.innerHTML = `<i class="fa-regular fa-file  fa-shake"" style="font-size:25px; color:#74C0FC"></i> ${item.name}`;
                        div.onclick = () => downloadFile(item.fullPath);
                        div.style.cursor='pointer'
                    }

                    container.appendChild(div);
                });
            });
    }

    // Load root folder
    const rootPath = "C:/Users/conti/OneDrive/Desktop";
    setTimeout(() => {
        loadFolder(rootPath, document.getElementById('explorer'));
    }, 2000);

    
     function downloadFile(filePath) {
        // Simple redirect triggers download
       window.location.href = "/api/download?path=" + encodeURIComponent(filePath);
    }
</script>

</body>
</html>
