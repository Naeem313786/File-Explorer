<!DOCTYPE html>
<html>
<head>
    <title>File Explorer</title>
    <style>
        body { font-family: Arial; }
        .folder { cursor: pointer; font-weight: bold; }
        .children { margin-left: 20px; cursor: pointer; }
        
    </style>
</head>
<body>

<h2>My File Explorer</h2>
<div id="explorer">Loading Files Please Wait...</div>

<script>
    function loadFolder(path, container) {
        history.replaceState(null, "", "/home?path=" + decodeURIComponent(path));
        fetch(`/files?path=${encodeURIComponent(path)}`)
            .then(res => res.json())
            .then(items => {

                container.innerHTML = ""; // clear

                items.forEach(item => {
                    const div = document.createElement("div");

                    if (item.isFolder) {
                        div.innerHTML = `üìÅ <span class="folder">${item.name}</span>`;

                        const childrenContainer = document.createElement("div");
                        childrenContainer.classList.add("children");

                        div.querySelector(".folder").onclick = () => {
                            if (childrenContainer.innerHTML.trim() === "") {
                                loadFolder(item.fullPath, childrenContainer);
                            } else {
                                childrenContainer.innerHTML = "";
                            }
                        };

                        div.appendChild(childrenContainer);
                        

                    } else {
                        div.innerHTML = `üìÑ ${item.name}`;
                        div.onclick = () => downloadFile(item.fullPath);
                        div.style.cursor='pointer'
                    }

                    container.appendChild(div);
                });
            });
    }

    // Load root folder
    const rootPath = "C:/Users/conti/OneDrive/Desktop";
    setTimeout(() => {
        loadFolder(rootPath, document.getElementById('explorer'));
    }, 2000);

    
     function downloadFile(filePath) {
        // Simple redirect triggers download
       window.location.href = "/api/download?path=" + encodeURIComponent(filePath);
    }
</script>

</body>
</html>
